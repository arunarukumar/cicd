pipeline {
  agent {
    docker {
      image 'abhishekf5/maven-abhishek-docker-agent:v1'
      args '--user root -v /var/run/docker.sock:/var/run/docker.sock'
    }
  }
  stages {
    stage('Checkout') {
      steps {
        echo 'Starting Checkout stage...'
        git branch: 'main', url: 'https://github.com/arunarukumar/cicd.git'
      }
    }
    stage('Stop and Remove Existing SonarQube Container') {
      steps {
        script {
          echo 'Stopping and removing existing SonarQube container...'
          sh 'docker stop sonarqube || true' // Stop if running, ignore if not found
          sh 'docker rm sonarqube || true'   // Remove if exists, ignore if not found
        }
      }
    }
    stage('Start SonarQube') {
      steps {
        script {
          echo 'Starting SonarQube...'
          sh 'docker run -d --name sonarqube -p 9001:9000 sonarqube'
          // Wait for SonarQube to start
          sh 'sleep 60'
        }
      }
    }
    // Add other stages as needed
  }
  post {
    always {
      script {
        // Clean up SonarQube container
        sh 'docker stop sonarqube'
        sh 'docker rm sonarqube'
      }
    }
  }
}
